# Nature Remo ホームダッシュボード - 設計ドキュメント

## 概要

このドキュメントは、Nature Remo ホームダッシュボードアプリケーションの設計、アーキテクチャ、実装の詳細について説明します。

## 目次

1. [プロジェクト目的](#プロジェクト目的)
2. [システムアーキテクチャ](#システムアーキテクチャ)
3. [技術選定理由](#技術選定理由)
4. [データフロー](#データフロー)
5. [コンポーネント設計](#コンポーネント設計)
6. [API統合](#API統合)
7. [UI/UXデザイン](#UIUXデザイン)
8. [CI/CDパイプライン](#CICDパイプライン)
9. [今後の改善点](#今後の改善点)

## プロジェクト目的

Nature Remo デバイスから取得した環境データ（温度、湿度、照度）を、わかりやすく視覚化し、リアルタイムでモニタリングできるダッシュボードを提供することを目的としています。

### 主要機能要件

1. **リアルタイム表示**: 各部屋の現在の温度・湿度・照度を表示
2. **履歴データ可視化**: 過去のデータをグラフで表示し、トレンドを把握
3. **時刻表示**: 日本語フォーマットで現在時刻を表示
4. **自動更新**: 5分間隔でデータを自動取得
5. **レスポンシブ対応**: あらゆるデバイスで快適に閲覧可能

## システムアーキテクチャ

### アーキテクチャ図

```
┌─────────────┐
│   ユーザー   │
└──────┬──────┘
       │
       ▼
┌──────────────────────────────────┐
│   Next.js Frontend (SSR/CSR)     │
│  ┌────────────────────────────┐  │
│  │   Pages (App Router)       │  │
│  │   - page.tsx (Dashboard)   │  │
│  └────────────────────────────┘  │
│  ┌────────────────────────────┐  │
│  │   Components               │  │
│  │   - Clock                  │  │
│  │   - RoomCard               │  │
│  │   - HistoryChart           │  │
│  └────────────────────────────┘  │
│  ┌────────────────────────────┐  │
│  │   Custom Hooks             │  │
│  │   - useNatureRemoData      │  │
│  └────────────────────────────┘  │
└──────────┬───────────────────────┘
           │
           ▼
┌──────────────────────────────────┐
│   API Client Layer               │
│   - NatureRemoClient             │
│   - Mock Data Generator          │
└──────────┬───────────────────────┘
           │
           ▼
┌──────────────────────────────────┐
│   Nature Remo Cloud API          │
│   https://api.nature.global      │
└──────────────────────────────────┘
```

### レイヤー構成

1. **プレゼンテーション層** (Components)
   - UI コンポーネント
   - ユーザーインタラクション処理

2. **ビジネスロジック層** (Hooks)
   - データ取得と状態管理
   - 5分間隔の自動更新ロジック

3. **データアクセス層** (API Client)
   - Nature Remo API との通信
   - データ変換とモック処理

## 技術選定理由

### Next.js 16

- **SSR/CSR ハイブリッド**: 初回ロード高速化とインタラクティブな体験
- **App Router**: モダンな React パターンとファイルベースルーティング
- **TypeScript サポート**: 型安全性と開発者体験の向上
- **最適化**: 画像、フォント、バンドルの自動最適化

### TypeScript

- **型安全性**: API レスポンスの型定義により、バグを防止
- **開発者体験**: IDE のオートコンプリートとリファクタリング支援
- **ドキュメント**: 型定義自体がドキュメントとして機能

### Tailwind CSS

- **ユーティリティファースト**: 迅速なスタイリング
- **レスポンシブ**: モバイルファーストのレスポンシブデザイン
- **ダークモード**: 簡単なダークモード実装
- **軽量**: 未使用のスタイルは自動削除

### Recharts

- **React ネイティブ**: React コンポーネントとして使用可能
- **柔軟性**: カスタマイズ性が高い
- **レスポンシブ**: 自動でコンテナサイズに適応
- **TypeScript サポート**: 型定義が充実

### date-fns

- **軽量**: Moment.js より軽量
- **モジュラー**: 必要な関数のみインポート
- **国際化**: 日本語ロケールサポート
- **イミュータブル**: 関数型プログラミングパターン

## データフロー

### 1. データ取得フロー

```
User Action / Timer
      ↓
useNatureRemoData Hook
      ↓
NatureRemoClient.getDevices()
      ↓
Nature Remo API (or Mock Data)
      ↓
convertToRoomData()
      ↓
State Update (setRoomData)
      ↓
UI Re-render
```

### 2. 自動更新フロー

```
Component Mount
      ↓
useEffect setup
      ↓
Initial fetchData()
      ↓
setInterval (5 minutes)
      ↓
Periodic fetchData()
      ↓
State Update
      ↓
UI Update
```

### 3. エラーハンドリングフロー

```
API Call
      ↓
   Error?
   ↙   ↘
Yes     No
 ↓       ↓
Error  Success
State   State
 ↓       ↓
Mock  Actual
Data   Data
 ↓       ↓
Display Warning
```

## コンポーネント設計

### 1. Clock コンポーネント

**責務**: 現在時刻を日本語フォーマットで表示

**状態管理**:
- `currentTime: Date` - 現在時刻（1秒ごとに更新）

**副作用**:
- `setInterval` で毎秒時刻を更新

### 2. RoomCard コンポーネント

**責務**: 1つの部屋の現在のセンサー値を表示

**Props**:
- `room: RoomData` - 部屋のデータ

**表示内容**:
- 部屋名
- 温度（🌡️アイコン + 値）
- 湿度（💧アイコン + 値）
- 照度（💡アイコン + 値）
- 最終更新時刻

### 3. HistoryChart コンポーネント

**責務**: 履歴データをグラフで可視化

**状態管理**:
- `selectedType: DataType` - 表示するデータ種別（温度/湿度/照度）
- `timeRange: number` - 表示期間（6/24/72時間）

**機能**:
- データ種別切り替えボタン
- 時間範囲切り替えボタン
- インタラクティブなグラフ表示

### 4. useNatureRemoData Hook

**責務**: データ取得と自動更新の管理

**返却値**:
- `roomData: RoomData[]` - 部屋データ配列
- `isLoading: boolean` - ローディング状態
- `error: string | null` - エラーメッセージ
- `lastFetched: Date | null` - 最終取得時刻
- `refetch: () => void` - 手動更新関数

**副作用**:
- 初回データ取得
- 5分間隔の自動更新
- クリーンアップ（コンポーネントアンマウント時）

## API統合

### Nature Remo API エンドポイント

**GET /1/devices**
- 認証: Bearer トークン
- レスポンス: `Device[]`
- 使用目的: 全デバイスのセンサー情報取得

### APIクライアント設計

```typescript
class NatureRemoClient {
  // 設定
  private apiToken: string
  private baseUrl: string
  
  // メソッド
  async getDevices(): Promise<Device[]>
  convertToRoomData(devices: Device[]): RoomData[]
}
```

### モックデータ

API トークンが未設定の場合、自動的にモックデータを生成:
- ランダムな温度・湿度・照度
- 複数部屋のシミュレーション
- 履歴データの疑似生成

## UI/UXデザイン

### カラーパレット

**ライトモード**:
- 背景: グレー系グラデーション（`from-gray-50 to-gray-100`）
- カード: ホワイト（`bg-white`）
- テキスト: ダークグレー（`text-gray-900`）
- アクセント:
  - 温度: 赤系（`text-red-600`）
  - 湿度: 青系（`text-blue-600`）
  - 照度: 黄色系（`text-yellow-600`）

**ダークモード**:
- 背景: ダークグラデーション（`dark:from-gray-900 dark:to-gray-800`）
- カード: ダークグレー（`dark:bg-gray-800`）
- テキスト: ライトグレー（`dark:text-white`）

### レイアウト

1. **ヘッダー**: タイトル + 時計
2. **ステータスバー**: 最終更新時刻 + 更新ボタン
3. **現在値セクション**: グリッドレイアウト（1〜3カラム）
4. **履歴セクション**: 部屋ごとのグラフ（垂直スタック）
5. **フッター**: クレジット情報

### レスポンシブブレークポイント

- **Mobile** (< 768px): 1カラム
- **Tablet** (768px - 1024px): 2カラム
- **Desktop** (> 1024px): 3カラム

## CI/CDパイプライン

### GitHub Actions ワークフロー

**トリガー**:
- `push` to `main` or `develop`
- `pull_request` to `main`

**ジョブ**:

1. **lint-and-build**
   - コードチェックアウト
   - Node.js セットアップ
   - 依存関係インストール
   - ESLint 実行
   - ビルド実行
   - アーティファクト保存

### 将来の拡張

- **テスト**: Jest + React Testing Library
- **E2E テスト**: Playwright
- **デプロイ**: Vercel 自動デプロイ
- **通知**: Slack 通知統合

## セキュリティ考慮事項

1. **API トークン管理**
   - 環境変数で管理（`.env`）
   - `.gitignore` で除外
   - クライアントサイドで使用（`NEXT_PUBLIC_` プレフィックス）

2. **HTTPS 通信**
   - Nature Remo API は HTTPS のみ

3. **入力検証**
   - TypeScript による型チェック
   - API レスポンスの検証

## パフォーマンス最適化

1. **データフェッチング**
   - `cache: 'no-store'` で常に最新データ取得
   - 5分間隔で適切なポーリング

2. **レンダリング最適化**
   - `useMemo` でグラフデータをメモ化
   - `useCallback` でコールバックをメモ化

3. **バンドルサイズ**
   - date-fns の必要な関数のみインポート
   - Tailwind CSS の未使用スタイル削除

## 今後の改善点

### 短期的改善

1. **エラーハンドリング強化**
   - リトライロジック
   - より詳細なエラーメッセージ

2. **ローディング状態改善**
   - スケルトンローディング
   - プログレスバー

3. **ユニットテスト**
   - コンポーネントテスト
   - Hooks テスト

### 中期的改善

1. **データ永続化**
   - データベース統合（PostgreSQL, MongoDB）
   - 履歴データの長期保存

2. **通知機能**
   - 閾値アラート
   - プッシュ通知

3. **ユーザー設定**
   - 表示単位のカスタマイズ
   - グラフカラーのカスタマイズ

### 長期的改善

1. **マルチユーザー対応**
   - 認証・認可
   - ユーザーごとのダッシュボード

2. **スマートホーム連携**
   - エアコン自動制御
   - 照明連携

3. **機械学習統合**
   - 異常検知
   - 予測分析

## スクリーンショット

以下は実際のアプリケーションのスクリーンショットです。

### ダッシュボード（ライトモード）

![Dashboard Light Mode](https://github.com/user-attachments/assets/e8bffea9-b4f6-4636-88dd-01bc27f160ec)

**主要機能:**
- 上部に現在時刻を日本語で表示（年月日、時分秒、曜日）
- 3つの部屋（リビング、寝室、書斎）の現在の温度、湿度、照度をカード形式で表示
- 各カードには絵文字アイコンと色分けされた値を表示
- 最終更新時刻と手動更新ボタン

### インタラクティブグラフ（湿度・6時間表示）

![Dashboard Interactive](https://github.com/user-attachments/assets/2c5fbba9-0ce3-498a-8f7f-158cf2190d3e)

**グラフ機能:**
- データ種別切り替え（温度・湿度・照度）
- 時間範囲切り替え（6時間・24時間・3日間）
- Rechartsによる滑らかなラインチャート
- ホバーでデータポイントの詳細を表示
- レスポンシブ対応で画面サイズに自動適応

### モバイル表示

モバイルデバイスでは、グリッドが1カラムに自動調整され、縦にスクロールして全ての情報を閲覧できます。

## まとめ

このプロジェクトは、Next.js と TypeScript を使用したモダンな Web アプリケーションとして設計されています。Nature Remo API との統合により、家庭の環境データをリアルタイムで可視化し、ユーザーに快適な体験を提供します。

今後も継続的な改善を行い、より使いやすく、機能豊富なダッシュボードへと発展させていく予定です。
